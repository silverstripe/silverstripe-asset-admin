!function(){"use strict";var e={961:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.Component=void 0;var r=f(n(4754)),o=p(n(7363)),i=n(2827),s=n(1624),a=f(n(4912)),d=p(n(3573)),l=f(n(7086)),c=n(4845);function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(u=function(e){return e?n:t})(e)}function p(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=u(t);if(n&&n.has(e))return n.get(e);var r={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var s=o?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(r,i,s):r[i]=e[i]}return r.default=e,n&&n.set(e,r),r}function f(e){return e&&e.__esModule?e:{default:e}}class m extends o.Component{constructor(e){super(e),this.handleSubmit=this.handleSubmit.bind(this)}componentDidMount(){this.setOverrides(this.props)}componentDidUpdate(e){this.props.isOpen&&!e.isOpen&&this.setOverrides(this.props)}componentWillUnmount(){this.clearOverrides()}setOverrides(e){if(this.props.schemaUrl!==e.schemaUrl&&this.clearOverrides(),e.schemaUrl){const t=Object.assign({},e.fileAttributes);delete t.ID;const n={fields:Object.entries(t).map((e=>{const[t,n]=e;return{name:t,value:n}}))};this.props.actions.schema.setSchemaStateOverrides(e.schemaUrl,n)}}getModalProps(){const e=Object.assign({onSubmit:this.handleSubmit,onLoadingError:this.handleLoadingError,showErrorMessage:!0,responseClassBad:"alert alert-danger",identifier:"AssetAdmin.InsertEmbedModal"},this.props,{className:`insert-embed-modal ${this.props.className}`,size:"lg",onClosed:this.props.onClosed,title:this.props.targetUrl?r.default._t("AssetAdmin.EditTitle","Media from the web"):r.default._t("AssetAdmin.CreateTitle","Insert new media from the web")});return delete e.sectionConfig,delete e.onInsert,delete e.fileAttributes,e}clearOverrides(){this.props.actions.schema.setSchemaStateOverrides(this.props.schemaUrl,null)}handleLoadingError(e){"function"==typeof this.props.onLoadingError&&this.props.onLoadingError(e)}handleSubmit(e,t){switch(t){case"action_addmedia":this.props.onCreate(e);break;case"action_insertmedia":this.props.onInsert(e);break;case"action_cancel":this.props.onClosed()}return Promise.resolve()}render(){const{FormBuilderModalComponent:e}=this.props;return o.default.createElement(e,this.getModalProps())}}t.Component=m,m.propTypes={sectionConfig:l.default.shape({url:l.default.string,form:l.default.object}),isOpen:l.default.bool,onInsert:l.default.func.isRequired,onCreate:l.default.func.isRequired,fileAttributes:l.default.shape({Url:l.default.string,CaptionText:l.default.string,PreviewUrl:l.default.string,Placement:l.default.string,Width:l.default.number,Height:l.default.number}),onClosed:l.default.func.isRequired,className:l.default.string,actions:l.default.object,schemaUrl:l.default.string.isRequired,targetUrl:l.default.string,onLoadingError:l.default.func,FormBuilderModalComponent:l.default.oneOfType([l.default.object,l.default.func])},m.defaultProps={className:"",fileAttributes:{},FormBuilderModalComponent:a.default};t.default=(0,s.connect)((function(e,t){const n=e.config.sections.find((e=>"SilverStripe\\AssetAdmin\\Controller\\AssetAdmin"===e.name)),r=t.fileAttributes?t.fileAttributes.Url:"",o=n.form.remoteEditForm.schemaUrl,i=r&&(0,c.joinUrlPaths)(o,`/?embedurl=${encodeURIComponent(r)}`),s=n.form.remoteCreateForm.schemaUrl;return{sectionConfig:n,schemaUrl:i||s,targetUrl:r}}),(function(e){return{actions:{schema:(0,i.bindActionCreators)(d,e)}}}))(m)},4912:function(e){e.exports=FormBuilderModal},6648:function(e){e.exports=Injector},7086:function(e){e.exports=PropTypes},7363:function(e){e.exports=React},9691:function(e){e.exports=ReactDomClient},1624:function(e){e.exports=ReactRedux},2827:function(e){e.exports=Redux},3573:function(e){e.exports=SchemaActions},3881:function(e){e.exports=ShortcodeSerialiser},4754:function(e){e.exports=i18n},5311:function(e){e.exports=jQuery},4845:function(e){e.exports=ssUrlLib}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}!function(){var e=l(n(5311)),t=l(n(7363)),r=n(9691),o=n(6648),i=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=d(t);if(n&&n.has(e))return n.get(e);var r={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var s=o?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(r,i,s):r[i]=e[i]}return r.default=e,n&&n.set(e,r),r}(n(3881)),s=l(n(961)),a=l(n(4754));function d(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(d=function(e){return e?n:t})(e)}function l(e){return e&&e.__esModule?e:{default:e}}const c=(0,o.loadComponent)(s.default),u='div[data-shortcode="embed"]';(()=>{const t=t=>{const n=a.default._t("AssetAdmin.INSERT_VIA_URL","Insert media via URL"),r=a.default._t("AssetAdmin.EDIT_MEDIA","Edit media"),o=a.default._t("AssetAdmin.DELETE_MEDIA","Delete media"),s=a.default._t("AssetAdmin.MEDIA","Media");return t.addCommand("ssembed",(()=>{(0,e.default)(`#${t.id}`).entwine("ss").openEmbedDialog()})),t.addCommand("ssembed-delete",(()=>{const e=t.selection.getNode();t.dom.is(e,u)?e.remove():t.dom.is(e.parentNode,u)?e.parentNode.remove():console.error({error:"Unexpected selection - expected embed",selectedNode:e})})),t.ui.registry.addButton("ssembed",{tooltip:n,icon:"embed",onAction:()=>t.execCommand("ssembed"),stateSelector:u}),t.ui.registry.addMenuItem("ssembed",{text:s,icon:"embed",onAction:()=>t.execCommand("ssembed")}),t.ui.registry.addButton("ssembededit",{tooltip:r,icon:"edit-block",onAction:()=>t.execCommand("ssembed")}),t.ui.registry.addButton("ssembeddelete",{tooltip:o,icon:"remove",onAction:()=>t.execCommand("ssembed-delete")}),t.ui.registry.addContextToolbar("ssembed",{predicate:e=>t.dom.is(e,u),position:"node",scope:"node",items:"alignleft aligncenter alignright | ssembededit ssembeddelete"}),t.on("BeforeExecCommand",(e=>{const n=e.command,r=e.ui,o=e.value;"mceMedia"===n&&(e.preventDefault(),t.execCommand("ssembed",r,o))})),t.on("GetContent",(t=>{const n=(0,e.default)(`<div>${t.content}</div>`);n.find(u).each((function(){const t=(0,e.default)(this),n=t.find("img.placeholder");if(0===n.length)return t.removeAttr("data-url"),void t.removeAttr("data-shortcode");const r=t.find(".caption").text(),o=parseInt(n.attr("width"),10),s=parseInt(n.attr("height"),10),a=t.data("url"),d=(0,i.sanitiseShortCodeProperties)({url:a,thumbnail:n.prop("src"),class:t.prop("class"),width:isNaN(o)?null:o,height:isNaN(s)?null:s,caption:r}),l=i.default.serialise({name:"embed",properties:d,wrapped:!0,content:d.url});t.replaceWith(l)})),t.content=n.html()})),t.on("BeforeSetContent",(t=>{let n=t.content,r=i.default.match("embed",!0,n);for(;r;){const t=r.properties,o=(0,e.default)("<div/>").attr("data-url",t.url||r.content).attr("data-shortcode","embed").addClass(t.class).addClass("ss-htmleditorfield-file embed"),s=(0,e.default)("<img />").attr("src",t.thumbnail).addClass("placeholder");if(t.width&&s.attr("width",t.width),t.height&&s.attr("height",t.height),o.append(s),t.caption){const n=(0,e.default)("<p />").addClass("caption").text(t.caption);o.append(n)}n=n.replace(r.original,(0,e.default)("<div/>").append(o).html()),r=i.default.match("embed",!0,n)}t.content=n})),{getMetadata(){return{name:"Silverstripe Embed",url:"https://docs.silverstripe.org/en/4/developer_guides/forms/field_types/htmleditorfield"}}}};tinymce.PluginManager.add("ssembed",(e=>t(e)))})(),e.default.entwine("ss",(n=>{n(".js-injector-boot #insert-embed-react__dialog-wrapper").entwine({Element:null,Data:{},ReactRoot:null,onunmatch(){this._clearModal()},_clearModal(){const e=this.getReactRoot();e&&(e.unmount(),this.setReactRoot(null))},open(){this._renderModal(!0)},close(){this.setData({}),this._renderModal(!1)},_renderModal(e){var n=this;const o=this.getOriginalAttributes();let i=this.getReactRoot();i||(i=(0,r.createRoot)(this[0])),i.render(t.default.createElement(c,{isOpen:e,onCreate:function(){return n._handleCreate(...arguments)},onInsert:function(){return n._handleInsert(...arguments)},onClosed:()=>this.close(),onLoadingError:function(){return n._handleLoadingError(...arguments)},bodyClassName:"modal__dialog",className:"insert-embed-react__dialog-wrapper",fileAttributes:o})),this.setReactRoot(i)},_handleLoadingError(){this.setData({}),this.open()},_handleInsert(e){const t=this.getData();this.setData(Object.assign({Url:t.Url},e)),this.insertRemote(),this.close()},_handleCreate(e){this.setData(Object.assign({},this.getData(),e)),this.open()},getOriginalAttributes(){const e=this.getData(),t=this.getElement();if(!t)return e;const r=n(t.getEditor().getSelectedNode());if(!r.length)return e;const o=r.closest(u).add(r.filter(u));if(!o.length)return e;const i=o.find("img.placeholder");if(0===i.length)return e;const s=o.find(".caption").text(),a=parseInt(i.width(),10),d=parseInt(i.height(),10);return{Url:o.data("url")||e.Url,CaptionText:s,PreviewUrl:i.attr("src"),Width:isNaN(a)?null:a,Height:isNaN(d)?null:d,Placement:this.findPosition(o.prop("class"))}},findPosition(e){if("string"!=typeof e)return"";const t=e.split(" ");return["leftAlone","center","rightAlone","left","right"].find((e=>t.indexOf(e)>-1))},insertRemote(){const t=this.getElement();if(!t)return!1;const r=t.getEditor();if(!r)return!1;const o=this.getData(),i=(0,e.default)("<div/>").attr("data-url",o.Url).attr("data-shortcode","embed").addClass(o.Placement).addClass("ss-htmleditorfield-file embed"),s=(0,e.default)("<img />").attr("src",o.PreviewUrl).addClass("placeholder");if(o.Width&&s.attr("width",o.Width),o.Height&&s.attr("height",o.Height),i.append(s),o.CaptionText){const t=(0,e.default)("<p />").addClass("caption").text(o.CaptionText);i.append(t)}const a=n(r.getSelectedNode());let d=n(null);return a.length&&(d=a.filter(u),0===d.length&&(d=a.closest(u)),0===d.length&&(d=a.filter("img.placeholder"))),d.length?d.replaceWith(i):(r.repaint(),r.insertContent(n("<div />").append(i.clone()).html(),{skip_undo:1})),r.addUndo(),r.repaint(),!0}})}))}()}();